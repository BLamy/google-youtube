<link rel="import" href="../polymer/polymer.html">

<!--
Element providing YouTube video playback.

##### Example

    <google-youtube videoId="mN7IAaRdi_k"></google-youtube>

@element google-youtube
@blurb Element providing YouTube video playback.
@status alpha
@url github.io
-->
<polymer-element name="google-youtube" attributes="videoId">
  <template>
    <link href="google-youtube.css" rel="stylesheet" />

    <content>
      <div id="player"></div>
    </content>
  </template>

  <script>
    if (window.YT && window.YT.Player) {
      initPolymer();
    } else {
      var tag = document.createElement('script');
      tag.src = '//www.youtube.com/iframe_api';
      document.head.appendChild(tag);

      var existingYouTubeIframeAPIReadyCallback = window.onYouTubeIframeAPIReady;
      window.onYouTubeIframeAPIReady = function() {
        initPolymer();

        if (existingYouTubeIframeAPIReadyCallback) {
          existingYouTubeIframeAPIReadyCallback();
        }
      };
    }

    function initPolymer() {
      Polymer('google-youtube', {
        videoId: 'mN7IAaRdi_k',

        videoIdChanged: function() {
          this.player.loadVideoById(this.videoId);
        },

        play: function() {
          this.player.playVideo();
        },

        pause: function() {
          this.player.pauseVideo();
        },

        seekTo: function(seconds) {
          this.player.seekTo(seconds);
        },

        ready: function() {
          var that = this;
          var eventProxyFunctions = {};
          ['onReady', 'onStateChange', 'onError'].forEach(function(eventName) {
            eventProxyFunctions[eventName] = function(e) {
              that.fire(eventName, e);
            };
          });

          var playerVars = {
            autohide: 1,
            controls: 2,
            playsinline: 1
          };
          for (var i = 0; i < this.attributes.length; i++) {
            var attribute = this.attributes[i];
            if (attribute.nodeName.toLowerCase() != 'videoid') {
              playerVars[attribute.nodeName] = attribute.value;
            }
          }

          this.player = new YT.Player(this.$.player, {
            videoId: this.videoId,
            width: '480px',
            height: '270px',
            playerVars: playerVars,
            events: eventProxyFunctions
          });
        }
      });
    }
  </script>
</polymer-element>
